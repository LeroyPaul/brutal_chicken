<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" /><title>Poule</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.51.0/dist/phaser.js">
    </script>

    <style type="text/css"> body 
    
        { margin: 0; 
        }

    </style>
</head>
<body>
    <script type="text/javascript">

class scene1 extends Phaser.Scene{
    constructor(){
    super("scene1");
}



preload(){
    this.load.image("Phaser_tuilesdejeu", "assets/essai.png");

    this.load.tilemapTiledJSON("carte", "essaiTiled.json");  

    this.load.spritesheet('perso','assets/poule.png',
    { frameWidth: 32, frameHeight: 32 });
}

create(){
    const carte = this.make.tilemap({ key: 'carte' });
    // importer les TileSet 
    const tileset = carte.addTilesetImage(
            "tuileTest",
            "Phaser_tuilesdejeu"
            );  

    const plateforme = carte.createLayer(
            "plateforme",
            tileset
            );

            this.velocity = 0

    ///////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////

    carte.getObjectLayer('spawnJoueur').objects.forEach((spawnJoueur) => {
        this.player = this.physics.add.sprite(spawnJoueur.x, spawnJoueur.y, 'perso').setOrigin(0);

        });

    this.player.body.setSize(16,20,true)
    this.player.setOffset(6, 12)
    
    this.physics.add.collider(this.player, plateforme);
    plateforme.setCollisionByProperty({ estSolide: true });

    this.player.setCollideWorldBounds(true);

    this.cameras.main.zoom = 2
    this.cameras.main.startFollow(this.player); 
    this.physics.world.setBounds(0, 0, 6400, 2880);
    this.cameras.main.setBounds(0, 0, 6400, 2880);
    
    this.timer = 0
    this.saut = 0


    ///////////////////////////////////////////////////////////////
    /////////////////////////TOUCHES///////////////////////////////
    ///////////////////////////////////////////////////////////////

    this.cursors = this.input.keyboard.createCursorKeys();
    this.keys = this.input.keyboard.addKeys({
    });

    // touches spÃ©ciales clavier + manettes
    this.toucheF = this.input.keyboard.addKey('F') ||this.paddle.A;
}

update(){


        this.moveUp = (this.cursors.up.isDown )  
        this.moveLeft = (this.cursors.left.isDown )  
        this.moveRight = (this.cursors.right.isDown ) 
        this.moveDown = ( this.cursors.down.isDown) 

    

        //SAUT
        if (this.moveUp && this.player.body.blocked.down ) {
            this.player.setVelocityY(-420);}

        //WALL JUMP    
        if (this.moveUp && this.player.body.blocked.left && this.moveLeft ) {
            this.wallJumpGauche = true}

        if (this.wallJumpGauche == true){
            this.player.setVelocityX(this.velocity);
            this.velocity = 240
            this.player.setVelocityY(-220);
            this.timer += 1
            if (this.timer == 10){
            this.wallJumpGauche = false
            this.timer = 0}}

        if (this.moveUp && this.player.body.blocked.right && this.moveRight ) {
            this.wallJumpDroite = true}

        if (this.wallJumpDroite == true){
            this.player.setVelocityX(this.velocity);
            this.velocity = -240
            this.player.setVelocityY(-220);
            this.timer += 1
            if (this.timer == 10){
            this.wallJumpDroite = false
            this.timer = 0}}

        

        //DEPLACEMENT HORIZONTAL
        if (this.moveLeft){ 
            this.player.direction = 'left';
            this.player.setVelocityX(this.velocity); 
            if (this.velocity > -200){
                this.velocity -= 20;}
        }
        else if (this.moveRight){ 
            this.player.direction = 'right';
            this.player.setVelocityX(this.velocity);

                if (this.velocity <200){
                this.velocity += 20;}
        }

        //RALENTISSEMENT SUR LE SOL
        else{ 
            this.player.setVelocityX(this.velocity);
            if (this.player.body.blocked.down ) {
                if (this.velocity > 0){
                    this.velocity -=  30;
                    if (this.velocity < 30){
                        this. velocity = 0}}
                if (this.velocity < 0){
                    this.velocity +=  30;
                    if (this.velocity > 30){
                        this. velocity = 0}}
            }
            
        //RALENTISSEMENT DANS L'AIR
            else {
                if (this.velocity > 0){
                    this.velocity -=  10;
                    if (this.velocity < 10){
                        this. velocity = 0}}
                if (this.velocity < 0){
                    this.velocity +=  10;
                    if (this.velocity > 10){
                        this. velocity = 0}}
            }
        }

        //RALENTISSEMENT CONTRE LES MURS
        if (this.player.body.blocked.right ) {
            this.player.setVelocityX(this.velocity);
            this.velocity = 0;
            if ( this.player.velocity([Y])<50){

            }
        }

        if (this.player.body.blocked.left ) {
            this.player.setVelocityY(50)
            this.player.setVelocityX(this.velocity);
            this.velocity = 0;}


               

            
    }   
}


var config = {
        type: Phaser.AUTO,
        width: 960, height: 540,
        physics: {
        default: 'arcade',
        arcade: {
        gravity: {y:1000},
        debug: true,
        }},
        pixelArt: true,
        roundPixel: true,
        scene: [scene1]
        };
        new Phaser.Game(config);


</script>
</body>
</html>
